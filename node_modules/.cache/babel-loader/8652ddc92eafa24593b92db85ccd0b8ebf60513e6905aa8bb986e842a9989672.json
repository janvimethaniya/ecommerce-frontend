{"ast":null,"code":"import { motionValue } from './index.mjs';\nimport { JSAnimation } from '../animation/JSAnimation.mjs';\nimport { isMotionValue } from './utils/is-motion-value.mjs';\nimport { frame } from '../frameloop/frame.mjs';\n\n/**\n * Create a `MotionValue` that animates to its latest value using a spring.\n * Can either be a value or track another `MotionValue`.\n *\n * ```jsx\n * const x = motionValue(0)\n * const y = transformValue(() => x.get() * 2) // double x\n * ```\n *\n * @param transformer - A transform function. This function must be pure with no side-effects or conditional statements.\n * @returns `MotionValue`\n *\n * @public\n */\nfunction springValue(source, options) {\n  const initialValue = isMotionValue(source) ? source.get() : source;\n  const value = motionValue(initialValue);\n  attachSpring(value, source, options);\n  return value;\n}\nfunction attachSpring(value, source, options) {\n  const initialValue = value.get();\n  let activeAnimation = null;\n  let latestValue = initialValue;\n  let latestSetter;\n  const unit = typeof initialValue === \"string\" ? initialValue.replace(/[\\d.-]/g, \"\") : undefined;\n  const stopAnimation = () => {\n    if (activeAnimation) {\n      activeAnimation.stop();\n      activeAnimation = null;\n    }\n  };\n  const startAnimation = () => {\n    stopAnimation();\n    activeAnimation = new JSAnimation({\n      keyframes: [asNumber(value.get()), asNumber(latestValue)],\n      velocity: value.getVelocity(),\n      type: \"spring\",\n      restDelta: 0.001,\n      restSpeed: 0.01,\n      ...options,\n      onUpdate: latestSetter\n    });\n  };\n  value.attach((v, set) => {\n    latestValue = v;\n    latestSetter = latest => set(parseValue(latest, unit));\n    frame.postRender(() => {\n      startAnimation();\n      value['events'].animationStart?.notify();\n      activeAnimation?.then(() => {\n        value['events'].animationComplete?.notify();\n      });\n    });\n  }, stopAnimation);\n  if (isMotionValue(source)) {\n    const removeSourceOnChange = source.on(\"change\", v => value.set(parseValue(v, unit)));\n    const removeValueOnDestroy = value.on(\"destroy\", removeSourceOnChange);\n    return () => {\n      removeSourceOnChange();\n      removeValueOnDestroy();\n    };\n  }\n  return stopAnimation;\n}\nfunction parseValue(v, unit) {\n  return unit ? v + unit : v;\n}\nfunction asNumber(v) {\n  return typeof v === \"number\" ? v : parseFloat(v);\n}\nexport { attachSpring, springValue };","map":{"version":3,"names":["springValue","source","options","initialValue","isMotionValue","get","value","motionValue","attachSpring","activeAnimation","latestValue","latestSetter","unit","replace","undefined","stopAnimation","stop","startAnimation","JSAnimation","keyframes","asNumber","velocity","getVelocity","type","restDelta","restSpeed","onUpdate","attach","v","set","latest","parseValue","frame","postRender","animationStart","notify","then","animationComplete","removeSourceOnChange","on","removeValueOnDestroy","parseFloat"],"sources":["D:\\new mern stack\\react\\project4\\ecommerce\\node_modules\\motion-dom\\src\\value\\spring-value.ts"],"sourcesContent":["import { MotionValue, motionValue } from \".\"\nimport { JSAnimation } from \"../animation/JSAnimation\"\nimport { AnyResolvedKeyframe, SpringOptions } from \"../animation/types\"\nimport { frame } from \"../frameloop\"\nimport { isMotionValue } from \"./utils/is-motion-value\"\n\n/**\n * Create a `MotionValue` that animates to its latest value using a spring.\n * Can either be a value or track another `MotionValue`.\n *\n * ```jsx\n * const x = motionValue(0)\n * const y = transformValue(() => x.get() * 2) // double x\n * ```\n *\n * @param transformer - A transform function. This function must be pure with no side-effects or conditional statements.\n * @returns `MotionValue`\n *\n * @public\n */\nexport function springValue<T extends AnyResolvedKeyframe>(\n    source: T | MotionValue<T>,\n    options?: SpringOptions\n) {\n    const initialValue = isMotionValue(source) ? source.get() : source\n    const value = motionValue(initialValue)\n\n    attachSpring(value, source, options)\n\n    return value\n}\n\nexport function attachSpring<T extends AnyResolvedKeyframe>(\n    value: MotionValue<T>,\n    source: T | MotionValue<T>,\n    options?: SpringOptions\n): VoidFunction {\n    const initialValue = value.get()\n\n    let activeAnimation: JSAnimation<number> | null = null\n    let latestValue = initialValue\n    let latestSetter: (v: T) => void\n\n    const unit =\n        typeof initialValue === \"string\"\n            ? initialValue.replace(/[\\d.-]/g, \"\")\n            : undefined\n\n    const stopAnimation = () => {\n        if (activeAnimation) {\n            activeAnimation.stop()\n            activeAnimation = null\n        }\n    }\n    const startAnimation = () => {\n        stopAnimation()\n\n        activeAnimation = new JSAnimation({\n            keyframes: [asNumber(value.get()), asNumber(latestValue)],\n            velocity: value.getVelocity(),\n            type: \"spring\",\n            restDelta: 0.001,\n            restSpeed: 0.01,\n            ...options,\n            onUpdate: latestSetter,\n        })\n    }\n\n    value.attach((v, set) => {\n        latestValue = v\n        latestSetter = (latest) => set(parseValue(latest, unit) as T)\n\n        frame.postRender(()=>{\n            startAnimation()\n            value['events'].animationStart?.notify()\n            activeAnimation?.then(()=>{\n                value['events'].animationComplete?.notify()\n            })\n        })\n    }, stopAnimation)\n\n    if (isMotionValue(source)) {\n        const removeSourceOnChange = source.on(\"change\", (v) =>\n            value.set(parseValue(v, unit) as T)\n        )\n\n        const removeValueOnDestroy = value.on(\"destroy\", removeSourceOnChange)\n\n        return () => {\n            removeSourceOnChange()\n            removeValueOnDestroy()\n        }\n    }\n\n    return stopAnimation\n}\n\nfunction parseValue(v: AnyResolvedKeyframe, unit?: string) {\n    return unit ? v + unit : v\n}\n\nfunction asNumber(v: AnyResolvedKeyframe) {\n    return typeof v === \"number\" ? v : parseFloat(v)\n}\n"],"mappings":";;;;;AAMA;;;;;;;;;;;;;AAaG;AACa,SAAAA,WAAWA,CACvBC,MAA0B,EAC1BC,OAAuB;EAEvB,MAAMC,YAAY,GAAGC,aAAa,CAACH,MAAM,CAAC,GAAGA,MAAM,CAACI,GAAG,EAAE,GAAGJ,MAAM;EAClE,MAAMK,KAAK,GAAGC,WAAW,CAACJ,YAAY,CAAC;EAEvCK,YAAY,CAACF,KAAK,EAAEL,MAAM,EAAEC,OAAO,CAAC;EAEpC,OAAOI,KAAK;AAChB;SAEgBE,YAAYA,CACxBF,KAAqB,EACrBL,MAA0B,EAC1BC,OAAuB;EAEvB,MAAMC,YAAY,GAAGG,KAAK,CAACD,GAAG,EAAE;EAEhC,IAAII,eAAe,GAA+B,IAAI;EACtD,IAAIC,WAAW,GAAGP,YAAY;EAC9B,IAAIQ,YAA4B;EAEhC,MAAMC,IAAI,GACN,OAAOT,YAAY,KAAK,QAAQ,GAC1BA,YAAY,CAACU,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC,GACnCC,SAAS;EAEnB,MAAMC,aAAa,GAAGA,CAAA,KAAK;IACvB,IAAIN,eAAe,EAAE;MACjBA,eAAe,CAACO,IAAI,EAAE;MACtBP,eAAe,GAAG,IAAI;;EAE9B,CAAC;EACD,MAAMQ,cAAc,GAAGA,CAAA,KAAK;IACxBF,aAAa,EAAE;IAEfN,eAAe,GAAG,IAAIS,WAAW,CAAC;MAC9BC,SAAS,EAAE,CAACC,QAAQ,CAACd,KAAK,CAACD,GAAG,EAAE,CAAC,EAAEe,QAAQ,CAACV,WAAW,CAAC,CAAC;MACzDW,QAAQ,EAAEf,KAAK,CAACgB,WAAW,EAAE;MAC7BC,IAAI,EAAE,QAAQ;MACdC,SAAS,EAAE,KAAK;MAChBC,SAAS,EAAE,IAAI;MACf,GAAGvB,OAAO;MACVwB,QAAQ,EAAEf;IACb,EAAC;EACN,CAAC;EAEDL,KAAK,CAACqB,MAAM,CAAC,CAACC,CAAC,EAAEC,GAAG,KAAI;IACpBnB,WAAW,GAAGkB,CAAC;IACfjB,YAAY,GAAImB,MAAM,IAAKD,GAAG,CAACE,UAAU,CAACD,MAAM,EAAElB,IAAI,CAAM,CAAC;IAE7DoB,KAAK,CAACC,UAAU,CAAC,MAAI;MACjBhB,cAAc,EAAE;MAChBX,KAAK,CAAC,QAAQ,CAAC,CAAC4B,cAAc,EAAEC,MAAM,EAAE;MACxC1B,eAAe,EAAE2B,IAAI,CAAC,MAAI;QACtB9B,KAAK,CAAC,QAAQ,CAAC,CAAC+B,iBAAiB,EAAEF,MAAM,EAAE;MAC/C,CAAC,CAAC;IACN,CAAC,CAAC;GACL,EAAEpB,aAAa,CAAC;EAEjB,IAAIX,aAAa,CAACH,MAAM,CAAC,EAAE;IACvB,MAAMqC,oBAAoB,GAAGrC,MAAM,CAACsC,EAAE,CAAC,QAAQ,EAAGX,CAAC,IAC/CtB,KAAK,CAACuB,GAAG,CAACE,UAAU,CAACH,CAAC,EAAEhB,IAAI,CAAM,CAAC,CACtC;IAED,MAAM4B,oBAAoB,GAAGlC,KAAK,CAACiC,EAAE,CAAC,SAAS,EAAED,oBAAoB,CAAC;IAEtE,OAAO,MAAK;MACRA,oBAAoB,EAAE;MACtBE,oBAAoB,EAAE;IAC1B,CAAC;;EAGL,OAAOzB,aAAa;AACxB;AAEA,SAASgB,UAAUA,CAACH,CAAsB,EAAEhB,IAAa;EACrD,OAAOA,IAAI,GAAGgB,CAAC,GAAGhB,IAAI,GAAGgB,CAAC;AAC9B;AAEA,SAASR,QAAQA,CAACQ,CAAsB;EACpC,OAAO,OAAOA,CAAC,KAAK,QAAQ,GAAGA,CAAC,GAAGa,UAAU,CAACb,CAAC,CAAC;AACpD","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}