{"ast":null,"code":"var _jsxFileName = \"D:\\\\new mern stack\\\\react\\\\project4\\\\ecommerce\\\\src\\\\Component\\\\payment\\\\UPIPayment.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { QRCodeSVG } from \"qrcode.react\";\nimport axios from \"axios\";\nimport qrImage from \"../../Component/Assets/qr1.jpeg\";\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst UPIPayment = ({\n  amount,\n  cartProducts,\n  address\n}) => {\n  _s();\n  const navigate = useNavigate();\n  const [paymentIntentId, setPaymentIntentId] = useState(\"\");\n  const [upiQR, setUpiQR] = useState(\"\");\n  const [paymentStatus, setPaymentStatus] = useState(\"\");\n  const handleUPIPayment = async () => {\n    try {\n      const token = localStorage.getItem(\"auth-token\");\n      const res = await axios.post(\"http://localhost:7000/create-payment\", {\n        amount\n      }, {\n        headers: {\n          \"auth-token\": token\n        }\n      });\n      const {\n        paymentIntentId\n      } = res.data; // <-- use paymentIntentId from backend\n      setPaymentIntentId(paymentIntentId);\n      const qrString = `upi://pay?pa=methaniyajanvi636@okaxis&pn=Janvi&am=${amount}&cu=INR&tr=${paymentIntentId}`;\n      setUpiQR(qrString);\n    } catch (err) {\n      console.log(\"Error creating payment:\", err);\n    }\n  };\n  const saveOrder = async () => {\n    const token = localStorage.getItem(\"auth-token\");\n    try {\n      await axios.post(\"http://localhost:7000/save-order\", {\n        cartItems: cartProducts,\n        totalAmount: amount,\n        paymentId: \"UPI_\" + paymentIntentId,\n        status: \"succeeded\",\n        address\n      }, {\n        headers: {\n          \"auth-token\": token\n        }\n      });\n      setTimeout(() => {\n        navigate(\"/myorders\");\n      }, 2000);\n    } catch (err) {\n      console.log(\"Error saving order:\", err);\n    }\n  };\n  useEffect(() => {\n    if (!paymentIntentId) return;\n    const interval = setInterval(async () => {\n      try {\n        const token = localStorage.getItem(\"auth-token\");\n        const res = await axios.post(\"http://localhost:7000/check-payment\", {\n          paymentIntentId\n        }, {\n          headers: {\n            \"auth-token\": token\n          }\n        });\n        if (res.data.status === \"succeeded\") {\n          setPaymentStatus(\"succeeded\");\n          clearInterval(interval);\n          saveOrder();\n        }\n      } catch (err) {\n        console.log(err);\n      }\n    }, 3000);\n    return () => clearInterval(interval);\n  }, [paymentIntentId]);\n  if (paymentStatus === \"succeeded\") {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        textAlign: \"center\",\n        marginTop: 50,\n        padding: \"30px\",\n        backgroundColor: \"#d4edda\",\n        borderRadius: \"8px\",\n        border: \"2px solid #28a745\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        style: {\n          color: \"#155724\",\n          marginTop: 0\n        },\n        children: \"\\u2713 Payment Successful!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          color: \"#155724\",\n          fontSize: \"16px\",\n          margin: \"10px 0\"\n        },\n        children: \"Your payment has been received.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          color: \"#155724\",\n          fontSize: \"14px\"\n        },\n        children: \"Saving order and redirecting...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      textAlign: \"center\",\n      marginTop: 50\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Pay via UPI\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"qr-area\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        children: [\"Scan this QR with your UPI app to pay \\u20B9\", amount]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 9\n      }, this), !paymentIntentId ? /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleUPIPayment,\n        style: {\n          padding: \"10px 20px\",\n          fontSize: \"16px\",\n          backgroundColor: \"#2d3436\",\n          color: \"white\",\n          border: \"none\",\n          borderRadius: \"5px\",\n          cursor: \"pointer\",\n          marginBottom: \"20px\"\n        },\n        children: \"Generate UPI QR Code\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"img\", {\n          src: qrImage,\n          alt: \"UPI QR\",\n          style: {\n            width: 250,\n            height: 250,\n            borderRadius: 10\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            marginTop: \"15px\",\n            color: \"#666\",\n            fontSize: \"14px\"\n          },\n          children: \"Waiting for payment confirmation...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 117,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 90,\n    columnNumber: 6\n  }, this);\n};\n_s(UPIPayment, \"zsiBgRCCHUM6t2M/BIw9W8tCf9E=\", false, function () {\n  return [useNavigate];\n});\n_c = UPIPayment;\nexport default UPIPayment;\nvar _c;\n$RefreshReg$(_c, \"UPIPayment\");","map":{"version":3,"names":["React","useState","useEffect","useNavigate","QRCodeSVG","axios","qrImage","jsxDEV","_jsxDEV","Fragment","_Fragment","UPIPayment","amount","cartProducts","address","_s","navigate","paymentIntentId","setPaymentIntentId","upiQR","setUpiQR","paymentStatus","setPaymentStatus","handleUPIPayment","token","localStorage","getItem","res","post","headers","data","qrString","err","console","log","saveOrder","cartItems","totalAmount","paymentId","status","setTimeout","interval","setInterval","clearInterval","style","textAlign","marginTop","padding","backgroundColor","borderRadius","border","children","color","fileName","_jsxFileName","lineNumber","columnNumber","fontSize","margin","className","onClick","cursor","marginBottom","src","alt","width","height","_c","$RefreshReg$"],"sources":["D:/new mern stack/react/project4/ecommerce/src/Component/payment/UPIPayment.jsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { QRCodeSVG } from \"qrcode.react\";\r\nimport axios from \"axios\";\r\nimport qrImage from \"../../Component/Assets/qr1.jpeg\";\r\nconst UPIPayment = ({ amount, cartProducts, address }) => {\r\n  const navigate = useNavigate();\r\n  const [paymentIntentId, setPaymentIntentId] = useState(\"\");\r\n  const [upiQR, setUpiQR] = useState(\"\");\r\n  const [paymentStatus, setPaymentStatus] = useState(\"\");\r\n\r\n  const handleUPIPayment = async () => {\r\n    try {\r\n      const token = localStorage.getItem(\"auth-token\");\r\n\r\n      const res = await axios.post(\r\n        \"http://localhost:7000/create-payment\",\r\n        { amount },\r\n        { headers: { \"auth-token\": token } }\r\n      );\r\n\r\n      const { paymentIntentId } = res.data; // <-- use paymentIntentId from backend\r\n      setPaymentIntentId(paymentIntentId);\r\n\r\n      const qrString = `upi://pay?pa=methaniyajanvi636@okaxis&pn=Janvi&am=${amount}&cu=INR&tr=${paymentIntentId}`;\r\n      setUpiQR(qrString);\r\n    } catch (err) {\r\n      console.log(\"Error creating payment:\", err);\r\n    }\r\n  };\r\n\r\n  const saveOrder = async () => {\r\n    const token = localStorage.getItem(\"auth-token\");\r\n    try {\r\n      await axios.post(\r\n        \"http://localhost:7000/save-order\",\r\n        {\r\n          cartItems: cartProducts,\r\n          totalAmount: amount,\r\n          paymentId: \"UPI_\" + paymentIntentId,\r\n          status: \"succeeded\",\r\n          address,\r\n        },\r\n        { headers: { \"auth-token\": token } }\r\n      );\r\n      setTimeout(() => {\r\n        navigate(\"/myorders\");\r\n      }, 2000);\r\n    } catch (err) {\r\n      console.log(\"Error saving order:\", err);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!paymentIntentId) return;\r\n\r\n    const interval = setInterval(async () => {\r\n      try {\r\n        const token = localStorage.getItem(\"auth-token\");\r\n        const res = await axios.post(\r\n          \"http://localhost:7000/check-payment\",\r\n          { paymentIntentId },\r\n          { headers: { \"auth-token\": token } }\r\n        );\r\n\r\n        if (res.data.status === \"succeeded\") {\r\n          setPaymentStatus(\"succeeded\");\r\n          clearInterval(interval);\r\n          saveOrder();\r\n        }\r\n      } catch (err) {\r\n        console.log(err);\r\n      }\r\n    }, 3000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, [paymentIntentId]);\r\n\r\n  if (paymentStatus === \"succeeded\") {\r\n    return (\r\n      <div style={{ textAlign: \"center\", marginTop: 50, padding: \"30px\", backgroundColor: \"#d4edda\", borderRadius: \"8px\", border: \"2px solid #28a745\" }}>\r\n        <h2 style={{ color: \"#155724\", marginTop: 0 }}>✓ Payment Successful!</h2>\r\n        <p style={{ color: \"#155724\", fontSize: \"16px\", margin: \"10px 0\" }}>Your payment has been received.</p>\r\n        <p style={{ color: \"#155724\", fontSize: \"14px\" }}>Saving order and redirecting...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n     <div style={{ textAlign: \"center\", marginTop: 50 }}>\r\n      <h2>Pay via UPI</h2>\r\n      <div className=\"qr-area\">\r\n        <p>Scan this QR with your UPI app to pay ₹{amount}</p>\r\n        {!paymentIntentId ? (\r\n          <button \r\n            onClick={handleUPIPayment}\r\n            style={{\r\n              padding: \"10px 20px\",\r\n              fontSize: \"16px\",\r\n              backgroundColor: \"#2d3436\",\r\n              color: \"white\",\r\n              border: \"none\",\r\n              borderRadius: \"5px\",\r\n              cursor: \"pointer\",\r\n              marginBottom: \"20px\"\r\n            }}\r\n          >\r\n            Generate UPI QR Code\r\n          </button>\r\n        ) : (\r\n          <>\r\n            <img\r\n              src={qrImage}\r\n              alt=\"UPI QR\"\r\n              style={{ width: 250, height: 250, borderRadius: 10 }}\r\n            />\r\n            <p style={{ marginTop: \"15px\", color: \"#666\", fontSize: \"14px\" }}>Waiting for payment confirmation...</p>\r\n          </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default UPIPayment;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}